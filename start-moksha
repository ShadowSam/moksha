#!/bin/bash
# Moksha initialization script

if [ ! $VIRTUAL_ENV ]; then
    if [ ! -d tg2env ]; then
        echo "Initializing a TurboGears2 virtual environment"
        virtualenv --no-site-packages tg2env
        source tg2env/bin/activate
        ./pip.py install -E tg2env -r stable-reqs.txt --extra-index-url=http://www.turbogears.org/2.0/downloads/current/index
        pushd moksha/widgetbrowser; python setup.py develop; popd
    else
        source tg2env/bin/activate
    fi
fi

python setup.py develop

echo "Starting Moksha..."

echo "Starting the WSGI stack..."
paster serve development.ini &
echo $! >> paster.pid

echo "Starting Orbited..."
orbited &
echo $! >> orbited.pid

echo "Starting the Moksha Hub..."
moksha-hub -v &
echo $! >> hub.pid

#echo "Starting memcached..."
#memcached &
#echo $! > memcached.pid
